<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ULTIMATE FLAG ARENA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap');
        body { margin: 0; background: radial-gradient(circle, #0a0a14 0%, #000 100%); color: #fff; font-family: 'Rajdhani', sans-serif; overflow: hidden; height: 100vh; text-align: center; }
        
        .main-title { font-family: 'Orbitron', sans-serif; font-size: 3rem; margin: 10px 0; color: #ff0000; text-shadow: 0 0 15px #ff0000; letter-spacing: 5px; }

        /* TEK SATIR KAYAN YAZI */
        .mega-language-bar { background: #000; border-bottom: 3px solid #ff0000; padding: 10px 0; overflow: hidden; white-space: nowrap; width: 100%; position: relative; }
        .mega-scroll-text { display: inline-block; padding-left: 100%; animation: mega-scroll 25s linear infinite; font-size: 1.8rem; font-family: 'Orbitron'; color: #ff0000; }
        @keyframes mega-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .main-container { display: grid; grid-template-columns: 250px 1fr 250px; height: calc(100vh - 150px); gap: 15px; padding: 10px; }
        #arena { display: flex; justify-content: center; align-items: center; gap: 50px; position: relative; }

        /* KARTLAR */
        .country-card { width: 185px; height: 255px; perspective: 1500px; transition: all 0.8s ease; position: relative; }
        
        /* BÄ°RÄ°NCÄ° EFEKTÄ° */
        .leader { order: 2; transform: scale(1.4); z-index: 100; }
        .leader::after { content: "ðŸ‘‘"; position: absolute; top: -55px; left: 50%; transform: translateX(-50%); font-size: 50px; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { top: -60px; } to { top: -45px; } }

        .leader .card-inner { border: 4px solid #ffea00 !important; box-shadow: 0 0 30px #ffea00; animation: leader-flip 6s infinite ease-in-out !important; }
        @keyframes leader-flip { 0%, 40% { transform: rotateY(0deg); } 50%, 90% { transform: rotateY(180deg); } 100% { transform: rotateY(360deg); } }

        /* GENEL KART STÄ°LÄ° */
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.8s; transform-style: preserve-3d; border-radius: 20px; border: 2px solid #333; background: #0f0f1a; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 18px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card-back { transform: rotateY(180deg); background: linear-gradient(135deg, #1a1a2e 0%, #000 100%); }
        
        .flag-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #fff; }
        .score { font-size: 2.2rem; color: #00ffaa; font-family: 'Orbitron'; }
        .king-img { width: 85px; height: 85px; border-radius: 50%; border: 3px solid #ffea00; }

        .side-panel { background: rgba(255, 255, 255, 0.05); border-radius: 15px; overflow: hidden; }
        .panel-title { background: #ff0000; padding: 10px; font-family: 'Orbitron'; font-size: 0.9rem; }
        .list-container { padding: 10px; font-size: 0.9rem; text-align: left; }

        .card-exit { animation: cardFall 0.8s ease-in forwards; }
        @keyframes cardFall { to { transform: translateY(1000px); opacity: 0; } }
    </style>
</head>
<body>
    <div class="main-title">GLOBAL FLAG ARENA</div>
    <div class="mega-language-bar">
        <div class="mega-scroll-text">ðŸ‘‘ ÃœLKENÄ° DESTEKLE: TR, AZ, KU, SY, IQ, IR, US, DE, FR ðŸ‘‘ TOP 3 SURVIVAL ARENA ðŸ‘‘</div>
    </div>
    <div class="main-container">
        <div class="side-panel"><div class="panel-title">CHAT</div><div id="chat-list" class="list-container"></div></div>
        <div id="arena"></div>
        <div class="side-panel"><div class="panel-title">EVENTS</div><div id="gift-list" class="list-container"></div></div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io(); // Render'da otomatik baÄŸlanÄ±r
        const arena = document.getElementById('arena');
        const countryScores = {};
        let activeCodes = [];

        function updatePositions() {
            let sorted = [...activeCodes].sort((a, b) => (countryScores[b] || 0) - (countryScores[a] || 0));
            activeCodes.forEach(code => {
                const card = document.getElementById(`card-${code}`);
                if (card) {
                    card.classList.remove('leader');
                    if (sorted.indexOf(code) === 0) card.classList.add('leader');
                }
            });
        }

        socket.on('score_update', (data) => {
            const code = data.country;
            countryScores[code] = data.totalScore;
            if (!document.getElementById(`card-${code}`)) {
                if (activeCodes.length >= 3) {
                    let loser = activeCodes.sort((a,b) => countryScores[a] - countryScores[b])[0];
                    document.getElementById(`card-${loser}`).classList.add('card-exit');
                    setTimeout(() => { document.getElementById(`card-${loser}`).remove(); }, 800);
                    activeCodes = activeCodes.filter(c => c !== loser);
                }
                activeCodes.push(code);
                const flagUrl = code === 'KU' ? 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Flag_of_Kurdistan.svg/330px-Flag_of_Kurdistan.svg.png' : `https://flagcdn.com/w160/${code.toLowerCase()}.png`;
                arena.insertAdjacentHTML('beforeend', `<div class="country-card" id="card-${code}"><div class="card-inner"><div class="card-front"><img src="${flagUrl}" class="flag-img"><h2>${code}</h2><div class="score" id="score-${code}">0</div></div><div class="card-back"><span style="color:#ffea00">KING</span><img src="${data.profilePic}" class="king-img" onerror="this.src='https://www.pngall.com/wp-content/uploads/5/User-Profile-PNG.png'"><div style="margin-top:5px">${data.user}</div></div></div></div>`);
            }
            document.getElementById(`score-${code}`).innerText = data.totalScore;
            updatePositions();
        });
    </script>
</body>
</html>
